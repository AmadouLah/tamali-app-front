<div class="change-password-container">
  <!-- Background animations -->
  <div class="liquid-gradient fixed inset-0 -z-10 bg-gradient-to-br from-slate-900/90 via-purple-900/80 to-slate-900/90"></div>
  <div class="geometric-shapes fixed inset-0 -z-10"></div>

  <div class="min-h-screen flex items-center justify-center p-6">
    <div class="w-full max-w-md">
      <app-glass-card variant="strong" class="p-8">
        <div class="text-center mb-6">
          <h1 class="text-3xl font-bold text-white mb-2">Changement de mot de passe</h1>
          <p class="text-gray-300">
            Vous devez changer votre mot de passe temporaire avant de continuer.
          </p>
        </div>

        @if (error) {
          <div class="mb-4 p-4 bg-red-500/20 border border-red-500/50 rounded-lg">
            <p class="text-red-300 text-sm">{{ error }}</p>
          </div>
        }

        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Mot de passe temporaire <span class="text-red-400">*</span>
              </label>
              <input
                type="password"
                formControlName="currentPassword"
                [class.border-red-500]="isFieldInvalid('currentPassword')"
                class="w-full px-4 py-3 glass-effect-subtle border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-400/50"
                placeholder="Entrez votre mot de passe temporaire"
              />
              @if (isFieldInvalid('currentPassword')) {
                <p class="mt-1 text-sm text-red-400">{{ getFieldError('currentPassword') }}</p>
              }
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Nouveau mot de passe <span class="text-red-400">*</span>
              </label>
              <input
                type="password"
                formControlName="newPassword"
                [class.border-red-500]="isFieldInvalid('newPassword')"
                class="w-full px-4 py-3 glass-effect-subtle border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-400/50"
                placeholder="Minimum 6 caractères"
              />
              @if (isFieldInvalid('newPassword')) {
                <p class="mt-1 text-sm text-red-400">{{ getFieldError('newPassword') }}</p>
              }
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">
                Confirmer le nouveau mot de passe <span class="text-red-400">*</span>
              </label>
              <input
                type="password"
                formControlName="confirmPassword"
                [class.border-red-500]="isFieldInvalid('confirmPassword') || form.errors?.['passwordMismatch']"
                class="w-full px-4 py-3 glass-effect-subtle border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-400/50"
                placeholder="Répétez le nouveau mot de passe"
              />
              @if (isFieldInvalid('confirmPassword')) {
                <p class="mt-1 text-sm text-red-400">{{ getFieldError('confirmPassword') }}</p>
              }
              @if (form.errors?.['passwordMismatch'] && form.get('confirmPassword')?.touched) {
                <p class="mt-1 text-sm text-red-400">Les mots de passe ne correspondent pas</p>
              }
            </div>

            <button
              type="submit"
              [disabled]="form.invalid || loading"
              class="w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
            >
              @if (loading) {
                <span>Changement en cours...</span>
              } @else {
                <span>Changer le mot de passe</span>
              }
            </button>
          </div>
        </form>
      </app-glass-card>
    </div>
  </div>
</div>
