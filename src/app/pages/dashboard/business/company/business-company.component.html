<div class="business-company-container min-h-screen relative overflow-x-hidden" data-theme="liquidGlace">
  <div class="liquid-gradient fixed inset-0 -z-10"></div>
  <div class="fixed inset-0 -z-10 bg-gradient-to-br from-slate-900/90 via-purple-900/80 to-slate-900/90"></div>
  <div class="geometric-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
  </div>

  <app-admin-sidebar
    [menuItems]="menuItems"
    [activeMenu]="activeMenu"
    [mobileOpen]="sidebarOpen"
    (mobileOpenChange)="sidebarOpen = $event"
    (menuClick)="setActiveMenu($event)"
  ></app-admin-sidebar>

  <div class="dashboard-main">
    <header class="glass-effect-strong border-b border-white/20 dashboard-header sticky top-0 z-30">
      <button
        type="button"
        class="lg:hidden shrink-0 p-2 rounded-lg glass-effect-subtle border border-white/20 text-white hover:bg-white/10 transition-colors"
        (click)="sidebarOpen = !sidebarOpen"
        aria-label="Ouvrir le menu"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
      <h1 class="text-xl md:text-2xl font-bold text-white truncate min-w-0 flex-1">Mon entreprise</h1>
      <div class="flex items-center gap-3 pl-4 border-l border-white/20 shrink-0">
        <div class="text-right">
          <div class="text-sm font-semibold text-white">{{ getDisplayName() }}</div>
          <div class="text-xs text-gray-300">{{ business?.name || 'Propriétaire' }}</div>
        </div>
        <app-user-avatar [user]="user"></app-user-avatar>
      </div>
    </header>

    <main class="dashboard-content">
      <div class="max-w-3xl mx-auto space-y-6">
        @if (error) {
          <div class="p-4 bg-red-500/20 border border-red-500/50 rounded-lg text-red-200 text-sm">{{ error }}</div>
        }
        @if (success) {
          <div class="p-4 bg-green-500/20 border border-green-500/50 rounded-lg text-green-200 text-sm">{{ success }}</div>
        }

        <form [formGroup]="form" (ngSubmit)="save()">
          <app-glass-card variant="strong" class="p-6 mb-6">
            <h2 class="text-lg font-bold text-white mb-4">Identité</h2>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">Nom <span class="text-red-400">*</span></label>
                <input type="text" formControlName="name"
                  class="input-field"
                  placeholder="Nom de l'entreprise" />
                @if (isFieldInvalid('name')) {
                  <p class="mt-1 text-sm text-red-400">{{ getFieldError('name') }}</p>
                }
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">Secteur <span class="text-red-400">*</span></label>
                <select formControlName="sectorId" class="input-field">
                  <option value="">Sélectionnez</option>
                  @for (s of sectors; track s.id) {
                    <option [value]="s.id">{{ s.name }}</option>
                  }
                </select>
                @if (isFieldInvalid('sectorId')) {
                  <p class="mt-1 text-sm text-red-400">{{ getFieldError('sectorId') }}</p>
                }
              </div>
            </div>
          </app-glass-card>

          <app-glass-card variant="strong" class="p-6 mb-6">
            <h2 class="text-lg font-bold text-white mb-4">Coordonnées</h2>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">Adresse <span class="text-red-400">*</span></label>
                <textarea formControlName="address" rows="2" class="input-field" placeholder="Adresse complète"></textarea>
                @if (isFieldInvalid('address')) {
                  <p class="mt-1 text-sm text-red-400">{{ getFieldError('address') }}</p>
                }
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-1">Téléphone <span class="text-red-400">*</span></label>
                  <input type="tel" formControlName="phone" class="input-field" placeholder="Téléphone" />
                  @if (isFieldInvalid('phone')) {
                    <p class="mt-1 text-sm text-red-400">{{ getFieldError('phone') }}</p>
                  }
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-300 mb-1">Pays <span class="text-red-400">*</span></label>
                  <input type="text" formControlName="country" class="input-field" placeholder="Pays" />
                  @if (isFieldInvalid('country')) {
                    <p class="mt-1 text-sm text-red-400">{{ getFieldError('country') }}</p>
                  }
                </div>
              </div>
            </div>
          </app-glass-card>

          <app-glass-card variant="strong" class="p-6 mb-6">
            <h2 class="text-lg font-bold text-white mb-4">Réglementation</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">N° RC</label>
                <input type="text" formControlName="commerceRegisterNumber" class="input-field" placeholder="Registre de commerce" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">N° identification</label>
                <input type="text" formControlName="identificationNumber" class="input-field" placeholder="NIF, NIU..." />
              </div>
            </div>
          </app-glass-card>

          <app-glass-card variant="strong" class="p-6 mb-6">
            <h2 class="text-lg font-bold text-white mb-4">Légal & finance</h2>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">Forme juridique <span class="text-red-400">*</span></label>
                <select formControlName="legalStatus" class="input-field">
                  <option value="">Sélectionnez</option>
                  @for (ls of legalStatuses; track ls.value) {
                    <option [value]="ls.value">{{ ls.label }}</option>
                  }
                </select>
                @if (isFieldInvalid('legalStatus')) {
                  <p class="mt-1 text-sm text-red-400">{{ getFieldError('legalStatus') }}</p>
                }
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">N° compte bancaire</label>
                <input type="text" formControlName="bankAccountNumber" class="input-field" placeholder="IBAN ou numéro de compte" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-300 mb-1">Site web</label>
                <input type="url" formControlName="websiteUrl" class="input-field" placeholder="https://..." />
              </div>
            </div>
          </app-glass-card>

          <app-glass-card variant="strong" class="p-6 mb-6">
            <h2 class="text-lg font-bold text-white mb-4">Logo</h2>
            <div class="flex items-center gap-4">
              @if (logoPreview) {
                <img [src]="logoPreview" alt="Logo" class="w-24 h-24 object-contain rounded-lg border border-white/20" />
              }
              <div>
                <input type="file" accept="image/*" (change)="onLogoSelected($event)"
                  class="block w-full text-sm text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-purple-600 file:text-white file:cursor-pointer" />
                <p class="text-xs text-gray-400 mt-1">Laissez vide pour conserver l'actuel</p>
              </div>
            </div>
          </app-glass-card>

          <app-glass-card variant="strong" class="p-6 mb-6">
            <h2 class="text-lg font-bold text-white mb-4">Template de reçu</h2>
            <select formControlName="receiptTemplateId" class="input-field">
              <option value="">Sélectionnez un template</option>
              @for (t of templates; track t.id) {
                <option [value]="t.id">{{ t.name }}</option>
              }
            </select>
          </app-glass-card>

          <div class="flex justify-end">
            <button type="submit" [disabled]="form.invalid || loading"
              class="btn btn-primary rounded-lg px-6 py-2 disabled:opacity-50">
              @if (loading) { Enregistrement... } @else { Enregistrer }
            </button>
          </div>
        </form>
      </div>
    </main>
  </div>
</div>
